<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
<title>Analysis of the drug screen</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7614 2013-02-21 15:55:51Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="analysis-of-the-drug-screen">
<h1 class="title">Analysis of the drug screen</h1>

<div class="section" id="first-step-data-set-for-a-new-classifier-for-the-drug-screen-data">
<h1>8/08/2016: First step: data set for a new classifier for the drug screen data</h1>
<p>We have noticed that appliction of the mitocheck-classifier seems to
be sub-optimal. Therefore, I train a new classifier on the drug
data.</p>
<p>First, I had to select the movies. This was done with the help of the
plate views on <a class="reference external" href="http://olympia.biomedicale.univ-paris5.fr/plates/">plateview</a></p>
<p>There I selected spots for different drugs, some spots with no or
little effect (including also empty), most spots however with either
medium or strong effect. The objective is to avoid missing interesting
morphologies. Altogether, I selected 28 conditions, all with 2
fields (56 movies). Each movie was selected in triplicates (from
labteks LT0900_01, LT0900_02, LT0900_05).</p>
</div>
<div class="section" id="technical-issues">
<h1>10/08/2016: Technical issues</h1>
<p>There were several technical issues.</p>
<p>First, the channel naming varied with the plate (either <tt class="docutils literal">Cy3</tt> or
<tt class="docutils literal">b_cy3</tt>). I therefore renamed, so that the channel is now always
<tt class="docutils literal">Cy3</tt>.
This is done with the script <tt class="docutils literal">src/rename_files.py</tt></p>
<p>Second, there is sometimes a high background. In principle, this does
not hurt for the segmentation, as the background is removed. But
CellCognition does a conversion to 8bit images, which is the same for
all movies. Consequently, images with a high background might actually
experience a reduction of the dynamic range. I therefore subtracted
the offset of all images by subtracting the 5%-percentile from each
image <tt class="docutils literal">src/offset_correction.py</tt></p>
</div>
<div class="section" id="annotation-of-morphologies">
<h1>12/08/2016: Annotation of morphologies</h1>
<p>I annotated morphologies, from these movies. Several
observations:</p>
<ul class="simple">
<li>There were conditions in which the prometaphases looked very
different from what has been in the training set. The nuclei were
very small and chromatine very condensed, so that they can be easily
confounded with apoptotic nuclei. This was typically followed by
decondensation (with polylobed or grape shaped nuclei as a
consequence).</li>
<li>There were some conditions, where a particular polylobed morphology
appeared (with a kidney shape). This shape does not seem to relate
to segregation defects, and thus not to mitotic phenotypes. It is
possible that this morphology also exists in the Mitocheck data
set.</li>
<li>There were no dynamic nuclei, no elongated nuclei, very few
binuclear nuclei, few artefact classes (splitting worked nicely!).</li>
<li>As we use a split strategy, it is difficult to detect the polylobed
systematically. Sometimes they are not split however, so that I
could annotate some. This problem has already occurred in the
Mitocheck data set (for which we also applied a split algorithm,
which was necessary for the tracking).</li>
</ul>
<p>This rises a number of questions.</p>
<ol class="arabic simple">
<li>What do we do with classes that are apparently not present (in the
sample I looked at)? Are they maintained in the classifier or do we
just remove them from the profiles (eventually putting them to zero)?</li>
<li>If we maintain classes that were not annotated in the data set,
this would refer to using a combined classifier. For this, we need to
join classifiers by combining arff-files (see below).</li>
<li>Do we reprocess the mitocheck data set (only classification!) in
order to find kidney-shaped nuclei (by a combined classifier)?</li>
</ol>
<p>Regarding question (1), I think that both alternatives can be
tested. For this, I built a classifier with only those morphologies
that were actually present in the drug data set (2420 nuclei). This is
the corresponding classifier (I removed the image data from version
control): <tt class="docutils literal">cecog_classifiers/classifier_2016_08_10_only_observed_classes</tt>.</p>
<p>This is in any case a working solution. The kidney class can be either
removed or joined with polylobed or interphase, or maintained in the
drug-screen data and not in the mitocheck data set. As a matter of
fact, we could argue that this kind of situation is typical when
comparing screens, and that the EMD allows us to compare profiles with
different classes, as long as we can define a cost matrix between the
classes.</p>
<p>In order to build a joined classifier, I wrote a script that joins two
arff files: <tt class="docutils literal">src/join_classifiers.py</tt>. The script is now running,
and a joint classifier has been trained:
<tt class="docutils literal">cecog_classifiers/res_join</tt>. The training phase for this classifier
is relatively long due to the large number of samples.</p>
<p>Finally, we have to decide, what to do with the kidney-shape class. My
feeling is that if we find a new class in the mitocheck data and if
this class allows us to find the molecular targets of this drug, this
will be a strong argument and a nice result. But there are many
&quot;ifs&quot;: it might be that this morphology will actually introduce more
problems than benefits. I think we can take the risk and look what's
coming out.</p>
<p>There are also still some technical issues related to the compilation
on the cluster: the system has been updated, and at the moment
cellcognition does not run because of several dependencies. I
re-compiled qt and PyQt. At the moment I am blocked by lxml (for which
I need the assistance of IT).</p>
<p>The following issues have been settled:</p>
<ul class="simple">
<li>Installation of lxml and its dependencies (done by IT).</li>
<li>Installation of PyQt4.</li>
<li>Installation of PyQt5. This was necessary, as the new version of
CellCognition depends on PyQt5. The Qt-dependency has been installed
in <tt class="docutils literal">/share/apps/user_apps/QT5</tt>. Probably, I should have installed
PyQt4 also to such a dedicated folder, but now it is in
<tt class="docutils literal"><span class="pre">/cbio/donnees/nvaroquaux/.local/</span></tt>. Importantly, the paths need to
point to the QT5 installation if a new version is to be used.</li>
<li>Update of CellCognition to the current version.</li>
</ul>
</div>
<div class="section" id="where-is-the-data-and-everything">
<h1>13/08/2016: Where is the data and everything?</h1>
<p>The original drug data can be found here:
<tt class="docutils literal">/share/data40T/aschoenauer/drug_screen/data_offset_corrected</tt>
As mentioned earlier, this data is offset-corrected and renamed.</p>
<p>I finally managed to start everything on the cluster.
For this, I have removed the PyQt4 installation. I noticed, that a
cecog-installation depending on PyQt4 exists inside the site-packages
(installed by Xiwei), which cannot be removed by me, as I do not have
the permissions. So, it is important to set the PYTHONPATH
properly. This has been modified in all sh-scripts (see below).</p>
<ul class="simple">
<li>Classification of drug data with the new classifier (without any
mitocheck annotation).<ul>
<li>result folder:
<tt class="docutils literal">/share/data40T/aschoenauer/drug_screen/results_August_2016/separated_classifier</tt></li>
<li>command to generate pbs-scripts: <tt class="docutils literal">python
Cecog_script_generation_drug_screen.py <span class="pre">-b</span>
pbs_drug_screen_features_classif_August2016.py</tt></li>
<li>command to submit the jobs on the cluster:
<tt class="docutils literal">qsub <span class="pre">-t</span> <span class="pre">1-808</span> <span class="pre">-tc</span> 200
/cbio/donnees/twalter/src/drug_screen/scripts/drug_screen_new.sh</tt></li>
<li>Computation time: 5h (with 160 jobs in parallel)</li>
</ul>
</li>
<li>Classification of drug data with the combined classifier.<ul>
<li>result folder:
<tt class="docutils literal">/share/data40T/aschoenauer/drug_screen/results_August_2016/joint_classifier</tt></li>
<li>command to generate pbs-scripts: <tt class="docutils literal">python
Cecog_script_generation_drug_screen.py <span class="pre">-b</span>
pbs_drug_screen_features_classif_August2016_joint_classifier.py</tt></li>
<li>command to submit the jobs on the cluster: <tt class="docutils literal">qsub <span class="pre">-t</span> <span class="pre">1-808</span>
/cbio/donnees/twalter/src/drug_screen/scripts/joint_cl/drugs_joint_cl.sh</tt></li>
<li>Computation time: 5h (with 160 jobs in parallel)</li>
</ul>
</li>
<li>Classification of the mitocheck data with the combined classifier.<ul>
<li>I could not work on the feature data directly: working with the
existing ch5-files is faster, but I then would erase the old
classification results. Consequently, I needed to re-segment. Not
storing the features also results in a smaller data set. But it
takes longer.</li>
<li>result folder:
<tt class="docutils literal">/share/data40T/aschoenauer/drug_screen/results_August_2016/mito_joint_classifier</tt></li>
<li>command to generate pbs-scripts:
<tt class="docutils literal">python Cecog_script_generation.py <span class="pre">-b</span> pbs_mitocheck_joint_classifier.py</tt></li>
<li>command to submit the jobs on the cluster:
<tt class="docutils literal">qsub —tc 40 t <span class="pre">1-25232</span>
/cbio/donnees/twalter/src/drug_screen/scripts/mito_joint/mitojoint.sh</tt>
(yes, that's quite a number of jobs ... and tc = 40 is also not
optimal, but if I do not do this, Nelle will kill me in a most
unpleasent way ... but perhaps we can alter this next week.)</li>
</ul>
</li>
</ul>
</div>
</div>
</body>
</html>
